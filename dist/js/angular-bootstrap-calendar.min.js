!function(e,t){"use strict";t.module("mwl.calendar",[]),t.module("mwl.calendar").constant("moment",e.moment),t.module("mwl.calendar").service("calendarHelper",["$filter","moment",function(e,a){function n(){return 1===a().startOf("week").day()}function r(e){return t.isDefined(e)?e:n()}function i(e,t,n){var r=a(e).startOf(t),i=a(e).endOf(t);return n.filter(function(e){return l.eventIsInPeriod(e.starts_at,e.ends_at,r,i)})}var l=this;this.getMonthNames=function(t){for(var a=t?"MMM":"MMMM",n=[],r=0;11>=r;r++)n.push(e("date")(new Date(2014,r),a));return n},this.getWeekDayNames=function(t,a){for(var n=t?"EEE":"EEEE",i=[],l=r(a)?22:21,d=0;6>=d;d++)i.push(e("date")(new Date(2014,8,l+d),n));return i},this.eventIsInPeriod=function(e,t,n,r){return e=a(e),t=a(t),n=a(n),r=a(r),e.isAfter(n)&&e.isBefore(r)||t.isAfter(n)&&t.isBefore(r)||e.isBefore(n)&&t.isAfter(r)||e.isSame(n)||t.isSame(r)},this.getYearView=function(e,t){for(var n=[],r=l.getMonthNames(),d=i(t,"year",e),c=0;3>c;c++){for(var s=[],o=0;4>o;o++){var u=12-r.length,f=new Date(a(t).format("YYYY"),u,1),m=a(f).add(1,"month").subtract(1,"second").toDate();s.push({label:r.shift(),monthIndex:u,isToday:a(f).startOf("month").isSame(a().startOf("month")),events:d.filter(function(e){return l.eventIsInPeriod(e.starts_at,e.ends_at,f,m)}),date:a(f).startOf("month")})}n.push(s)}return n},this.getMonthView=function(e,t,n){function d(){var e=o.day()-s;return 0>e&&(e=6),e}for(var c=i(t,"month",e),s=r(n)?1:0,o=a(t).startOf("month"),u=a(t).endOf("month").date(),f=[],m=new Array(7),v=c.map(function(e,t){return e.$id=t,e}),y=1;u>=y;y++){if(1===y)for(var w=d(o),h=o.clone();w>0;)w--,h=h.subtract(1,"day"),m[w]={label:h.date(),date:h.clone(),inMonth:!1,isPast:a().startOf("day").isAfter(h),isToday:a().startOf("day").isSame(h),isFuture:a().startOf("day").isBefore(h),events:[]};if(m[d(o)]={label:o.date(),inMonth:!0,isPast:a().startOf("day").isAfter(o),isToday:a().startOf("day").isSame(o),isFuture:a().startOf("day").isBefore(o),isWeekend:[0,6].indexOf(a(o).day())>-1,date:o.clone(),events:v.filter(function(e){return l.eventIsInPeriod(e.starts_at,e.ends_at,o.clone().startOf("day"),o.clone().endOf("day"))})},y===u){w=d(o);for(var p=o.clone();6>w;)w++,p=p.add(1,"day"),m[w]={label:p.date(),date:p.clone(),inMonth:!1,isPast:a().startOf("day").isAfter(p),isToday:a().startOf("day").isSame(p),isFuture:a().startOf("day").isBefore(p),events:[]}}(6===d(o)||y===u)&&(f.push(m),m=new Array(7)),o=o.add(1,"day")}return f},this.getWeekView=function(t,n,d){var c,s,o,u,f=i(n,"week",t),m=r(d)?1:0,v=new Array(7),y=l.getWeekDayNames(!1,d),w=n.getDay();for(o=w;o>=0;o--)u=a(n).subtract(w-o,"days").add(m,"day").toDate(),v[o]={weekDay:y[o],day:e("date")(u,"d"),date:e("date")(u,"d MMM"),isPast:a(u).startOf("day").isBefore(a().startOf("day")),isToday:a(u).startOf("day").isSame(a().startOf("day")),isFuture:a(u).startOf("day").isAfter(a().startOf("day")),isWeekend:[0,6].indexOf(a(u).day())>-1},0===o?c=u:6===o&&(s=u);for(o=w+1;7>o;o++)u=a(n).add(o-w,"days").add(m,"day").toDate(),v[o]={weekDay:y[o],day:e("date")(u,"d"),date:e("date")(u,"d MMM"),isPast:a(u).startOf("day").isBefore(a().startOf("day")),isToday:a(u).startOf("day").isSame(a().startOf("day")),isFuture:a(u).startOf("day").isAfter(a().startOf("day")),isWeekend:[0,6].indexOf(a(u).day())>-1},0===o?c=u:6===o&&(s=u);s=a(s).endOf("day").toDate(),c=a(c).startOf("day").toDate();var h=f.filter(function(e){return l.eventIsInPeriod(e.starts_at,e.ends_at,c,s)}).map(function(e){var t,n,r=a(e.starts_at).startOf("day"),i=a(e.ends_at).startOf("day"),l=a(c).startOf("day"),d=a(s).startOf("day");return t=r.isBefore(l)||r.isSame(l)?0:r.diff(l,"days"),i.isAfter(d)&&(i=d),r.isBefore(l)&&(r=l),n=a(i).diff(r,"days")+1,e.daySpan=n,e.dayOffset=t,e});return{columns:v,events:h}},this.getDayView=function(e,t,n,r,d){var c=i(t,"day",e),s=a(t).startOf("day").add(n,"hours"),o=a(t).startOf("day").add(r,"hours"),u=(r-n+1)*d,f=d/60,m=[];return c.filter(function(e){return l.eventIsInPeriod(e.starts_at,e.ends_at,a(t).startOf("day").toDate(),a(t).endOf("day").toDate())}).map(function(e){if(e.top=a(e.starts_at).isBefore(s)?0:a(e.starts_at).startOf("minute").diff(s.startOf("minute"),"minutes")*f-2,a(e.ends_at).isAfter(o))e.height=u-e.top;else{var t=e.starts_at;a(e.starts_at).isBefore(s)&&(t=s.toDate()),e.height=a(e.ends_at).diff(t,"minutes")*f}return e.top-e.height>u&&(e.height=0),e.left=0,e}).filter(function(e){return e.height>0}).map(function(e){var t=!0;return m.forEach(function(a,n){var r=!0;a.forEach(function(t){(l.eventIsInPeriod(e.starts_at,e.ends_at,t.starts_at,t.ends_at)||l.eventIsInPeriod(t.starts_at,t.ends_at,e.starts_at,e.ends_at))&&(r=!1)}),r&&t&&(t=!1,e.left=150*n,m[n].push(e))}),t&&(e.left=150*m.length,m.push([e])),e})},this.toggleEventBreakdown=function(e,t,a){function n(){e=e.map(function(e){return e.isOpened=!1,e.map(function(e){return e.isOpened=!1,e})})}var r=[];if(e[t][a].events.length>0){var i=e[t][a].isOpened;n(),e[t][a].isOpened=!i,e[t].isOpened=!i,r=e[t][a].events}else n();return{view:e,openEvents:r}}}]),t.module("mwl.calendar").filter("truncateEventTitle",function(){return function(e,t,a){return e?e.length>=t&&e.length/20>a/30?e.substr(0,t)+"...":e:""}}),t.module("mwl.calendar").directive("mwlCollapseFallback",["$injector",function(e){return e.has("collapseDirective")?{}:{restrict:"A",controller:["$scope","$attrs","$element",function(e,t,a){var n=e.$watch(t.mwlCollapseFallback,function(e){e?a.addClass("ng-hide"):a.removeClass("ng-hide")}),r=e.$on("$destroy",function(){r(),n()})}]}}]),t.module("mwl.calendar").directive("mwlCalendarYear",["moment",function(e){return{templateUrl:"templates/year.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=calendarEvents",currentDay:"=calendarCurrentDay",eventClick:"=calendarEventClick",eventEditClick:"=calendarEditEventClick",eventDeleteClick:"=calendarDeleteEventClick",editEventHtml:"=calendarEditEventHtml",deleteEventHtml:"=calendarDeleteEventHtml",autoOpen:"=calendarAutoOpen",timespanClick:"=calendarTimespanClick"},controller:["$scope","$sce","$timeout","calendarHelper",function(t,a,n,r){function i(){t.view=r.getYearView(t.events,t.currentDay),t.autoOpen&&!l&&t.view.forEach(function(a,r){a.forEach(function(a,i){a.label===e(t.currentDay).format("MMMM")&&(t.monthClicked(r,i,!0),n(function(){l=!1}))})})}var l=!1;t.$sce=a,t.$watch("currentDay",i),t.$watch("events",i,!0),t.monthClicked=function(e,a,n){n||t.timespanClick({calendarDate:t.view[e][a].date.startOf("month").toDate()});var i=r.toggleEventBreakdown(t.view,e,a);t.view=i.view,t.openEvents=i.openEvents},t.drillDown=function(a){var n=e(t.currentDay).clone().month(a).toDate();t.timespanClick({calendarDate:n})!==!1&&t.calendarCtrl.changeView("month",n)}}],link:function(e,t,a,n){e.calendarCtrl=n}}}]),t.module("mwl.calendar").directive("mwlCalendarWeek",function(){return{templateUrl:"templates/week.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=calendarEvents",currentDay:"=calendarCurrentDay",eventClick:"=calendarEventClick",useIsoWeek:"=calendarUseIsoWeek",timespanClick:"=calendarTimespanClick"},controller:["$scope","moment","calendarHelper",function(e,t,a){function n(){e.view=a.getWeekView(e.events,e.currentDay,e.useIsoWeek)}e.drillDown=function(a){var n=t(e.currentDay).clone().date(a).toDate();e.timespanClick({calendarDate:n})!==!1&&e.calendarCtrl.changeView("day",n)},e.$watch("currentDay",n),e.$watch("events",n,!0)}],link:function(e,t,a,n){e.calendarCtrl=n}}}),t.module("mwl.calendar").directive("mwlCalendarSlideBox",function(){return{restrict:"EA",templateUrl:"templates/calendarSlideBox.html",replace:!0,controller:["$scope","$attrs",function(e,t){var a=e.$watch(t.isOpen,function(t){e.shouldCollapse=t}),n=e.$on("$destroy",function(){n(),a()})}],require:["^?mwlCalendarMonth","^?mwlCalendarYear"],link:function(e,t,a,n){e.isMonthView=!!n[0],e.isYearView=!!n[1]}}}),t.module("mwl.calendar").directive("mwlCalendarMonth",function(){return{templateUrl:"templates/month.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=calendarEvents",currentDay:"=calendarCurrentDay",eventClick:"=calendarEventClick",eventEditClick:"=calendarEditEventClick",eventDeleteClick:"=calendarDeleteEventClick",editEventHtml:"=calendarEditEventHtml",deleteEventHtml:"=calendarDeleteEventHtml",autoOpen:"=calendarAutoOpen",useIsoWeek:"=calendarUseIsoWeek",timespanClick:"=calendarTimespanClick"},controller:["$scope","$sce","$timeout","moment","calendarHelper",function(e,t,a,n,r){function i(){e.view=r.getMonthView(e.events,e.currentDay,e.useIsoWeek),e.autoOpen&&!l&&e.view.forEach(function(t,r){t.forEach(function(t,i){t.inMonth&&n(e.currentDay).startOf("day").isSame(t.date.startOf("day"))&&(e.dayClicked(r,i,!0),a(function(){l=!1}))})})}var l=!1;e.$sce=t,e.$watch("currentDay",i),e.$watch("events",i,!0),e.weekDays=r.getWeekDayNames(!1,e.useIsoWeek),e.dayClicked=function(t,a,n){n||e.timespanClick({calendarDate:e.view[t][a].date.startOf("day").toDate()});var i=r.toggleEventBreakdown(e.view,t,a);e.view=i.view,e.openEvents=i.openEvents},e.drillDown=function(t){var a=n(e.currentDay).clone().date(t).toDate();e.timespanClick({calendarDate:a})!==!1&&e.calendarCtrl.changeView("day",a)},e.highlightEvent=function(t,a){e.view.forEach(function(e){e.forEach(function(e){if(delete e.highlightClass,a){var n=e.events.filter(function(e){return e.$id===t.$id}).length>0;n&&(e.highlightClass="day-highlight dh-event-"+t.type)}})})}}],link:function(e,t,a,n){e.calendarCtrl=n}}}),t.module("mwl.calendar").directive("mwlCalendarDay",function(){return{templateUrl:"templates/day.html",restrict:"EA",require:"^mwlCalendar",scope:{events:"=calendarEvents",currentDay:"=calendarCurrentDay",eventClick:"=calendarEventClick",eventLabel:"@calendarEventLabel",timeLabel:"@calendarTimeLabel",dayViewStart:"@calendarDayViewStart",dayViewEnd:"@calendarDayViewEnd",dayViewSplit:"@calendarDayViewSplit"},controller:["$scope","moment","calendarHelper",function(e,t,a){function n(){e.view=a.getDayView(e.events,e.currentDay,r.hours(),i.hours(),e.dayHeight)}var r=t(e.dayViewStart||"00:00","HH:mm"),i=t(e.dayViewEnd||"23:00","HH:mm");e.dayViewSplit=parseInt(e.dayViewSplit),e.dayHeight=60/e.dayViewSplit*30,e.days=[];for(var l=t(r),d=0;d<=i.diff(r,"hours");d++)e.days.push({label:l.format("ha")}),l.add(1,"hour");e.$watch("currentDay",n),e.$watch("events",n,!0)}]}}),t.module("mwl.calendar").directive("mwlCalendar",function(){return{templateUrl:"templates/main.html",restrict:"EA",scope:{events:"=calendarEvents",view:"=calendarView",currentDay:"=calendarCurrentDay",control:"=calendarControl",eventClick:"&calendarEventClick",eventEditClick:"&calendarEditEventClick",eventDeleteClick:"&calendarDeleteEventClick",editEventHtml:"=calendarEditEventHtml",deleteEventHtml:"=calendarDeleteEventHtml",autoOpen:"=calendarAutoOpen",useIsoWeek:"=calendarUseIsoWeek",eventLabel:"@calendarEventLabel",timeLabel:"@calendarTimeLabel",dayViewStart:"@calendarDayViewStart",dayViewEnd:"@calendarDayViewEnd",weekTitleLabel:"@calendarWeekTitleLabel",timespanClick:"&calendarTimespanClick",dayViewSplit:"@calendarDayViewSplit"},controller:["$scope","$timeout","$locale","$filter","moment",function(e,a,n,r,i){var l=this,d=e.weekTitleLabel||"Week {week} of {year}";this.titleFunctions={day:function(e){return r("date")(e,"EEEE d MMMM, yyyy")},week:function(e){return d.replace("{week}",i(e).week()).replace("{year}",i(e).format("YYYY"))},month:function(e){return r("date")(e,"MMMM yyyy")},year:function(e){return i(e).format("YYYY")}},this.changeView=function(t,a){e.view=t,e.currentDay=a},e.control=e.control||{},e.control.prev=function(){e.currentDay=i(e.currentDay).subtract(1,e.view).toDate()},e.control.next=function(){e.currentDay=i(e.currentDay).add(1,e.view).toDate()},e.control.getTitle=function(){return l.titleFunctions[e.view]?l.titleFunctions[e.view](e.currentDay):""};var c=!0,s=e.$watch(function(){return i.locale()+n.id},function(){if(c)return void(c=!1);var n=t.copy(e.view);e.view="redraw",a(function(){e.view=n})}),o=e.$on("$destroy",function(){o(),s()})}]}})}(window,angular);
//# sourceMappingURL=angular-bootstrap-calendar.min.js.map